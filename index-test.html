<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TESTE - Anest-App Qmentum</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo-anest.png">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="styles.css?v=1761080567">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a3d2e 0%, #0f2419 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .success { color: #43e97b; }
        .error { color: #f77062; }
        .warning { color: #fbc2eb; }
        
        button {
            background: #43e97b;
            color: #0f2419;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
        }
        
        button:hover {
            background: #38f9d7;
        }
        
        #log {
            text-align: left;
            background: #000;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>üß™ TESTE DE CARREGAMENTO</h1>
        
        <div id="status" class="status warning">
            ‚è≥ Iniciando testes...
        </div>
        
        <div id="log"></div>
        
        <button onclick="testFirebase()">üî• Testar Firebase</button>
        <button onclick="testScripts()">üìú Testar Scripts</button>
        <button onclick="goToApp()">üöÄ Ir para App Principal</button>
    </div>

    <script>
        const log = (msg, type = 'info') => {
            const logDiv = document.getElementById('log');
            const line = document.createElement('div');
            line.style.color = type === 'error' ? '#ff0000' : type === 'success' ? '#00ff00' : '#ffffff';
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        };

        const updateStatus = (msg, type) => {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = msg;
        };

        // Capturar erros
        window.addEventListener('error', (e) => {
            log(`‚ùå ERROR: ${e.message} | ${e.filename}:${e.lineno}`, 'error');
            updateStatus(`‚ùå Erro detectado: ${e.message}`, 'error');
        });

        log('‚úÖ P√°gina carregada', 'success');

        // Testar Firebase
        async function testFirebase() {
            log('üî• Testando Firebase...', 'info');
            updateStatus('üî• Testando Firebase...', 'warning');
            
            try {
                // 1. Verificar SDK
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK n√£o carregado');
                }
                log('‚úÖ Firebase SDK carregado', 'success');

                // 2. Carregar e executar firebase-config.js
                const response = await fetch('firebase-config.js');
                if (!response.ok) {
                    throw new Error(`Erro ao carregar firebase-config.js: ${response.status}`);
                }
                
                const configCode = await response.text();
                log('‚úÖ firebase-config.js baixado', 'success');
                
                // Executar c√≥digo
                eval(configCode);
                log('‚úÖ firebase-config.js executado', 'success');

                // 3. Verificar se auth e db est√£o dispon√≠veis
                if (typeof auth === 'undefined') {
                    throw new Error('auth n√£o foi definido');
                }
                log('‚úÖ auth dispon√≠vel', 'success');

                if (typeof db === 'undefined') {
                    throw new Error('db n√£o foi definido');
                }
                log('‚úÖ db dispon√≠vel', 'success');

                // 4. Testar autentica√ß√£o
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        log(`‚úÖ Usu√°rio logado: ${user.email}`, 'success');
                        updateStatus(`‚úÖ Firebase OK! Usu√°rio: ${user.email}`, 'success');
                    } else {
                        log('‚ÑπÔ∏è Nenhum usu√°rio logado', 'info');
                        updateStatus('‚úÖ Firebase OK! Nenhum usu√°rio logado', 'success');
                    }
                });

            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                updateStatus(`‚ùå Falha no Firebase: ${error.message}`, 'error');
            }
        }

        // Testar carregamento de scripts
        async function testScripts() {
            log('üìú Testando scripts...', 'info');
            updateStatus('üìú Testando scripts...', 'warning');
            
            const scripts = [
                'firebase-config.js',
                'rops-data-from-banco.js',
                'doses-pediatricas-data.js',
                'calculadoras-definitions.js',
                'documents-data.js',
                'app-sitemap-complete.js?v=1761080567',
                'anest-app-20251021173039.js?v=1761080567'
            ];
            
            let allOk = true;
            
            for (const script of scripts) {
                try {
                    const response = await fetch(script);
                    if (response.ok) {
                        const size = response.headers.get('content-length');
                        const sizeKB = size ? (parseInt(size) / 1024).toFixed(1) : '?';
                        log(`‚úÖ ${script} (${sizeKB}KB)`, 'success');
                    } else {
                        log(`‚ùå ${script} - Status ${response.status}`, 'error');
                        allOk = false;
                    }
                } catch (error) {
                    log(`‚ùå ${script} - ${error.message}`, 'error');
                    allOk = false;
                }
            }
            
            if (allOk) {
                updateStatus('‚úÖ Todos os scripts OK!', 'success');
            } else {
                updateStatus('‚ùå Alguns scripts falharam', 'error');
            }
        }

        function goToApp() {
            window.location.href = '/';
        }

        // Auto-test
        window.addEventListener('load', () => {
            setTimeout(testFirebase, 500);
        });
    </script>
</body>
</html>

